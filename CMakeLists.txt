# ===================================================================
# CMAKE のおまじない
# ===================================================================
cmake_minimum_required (VERSION 3.0)


# ===================================================================
# プロジェクト名，バージョンの設定
# ===================================================================
project (satpg)
set (SATPG_VERSION_MAJOR 1)
set (SATPG_VERSION_MINOR 0)
set (SATPG_VERSION ${SATPG_VERSION_MAJOR}.${SATPG_VERSION_MINOR})


# ===================================================================
# オプション
# ===================================================================
option (OPT_GPERFTOOLS "use google-perftools" OFF)


# ===================================================================
# CTest モジュールの読み込み
# ===================================================================
include (CTest)


# ===================================================================
# パッケージの検査
# ===================================================================
list (APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/cmake")

include (FindDoxygen)

include (FindPythonInterp)
include (FindPythonLibs)

find_package(TCL)

if ( OPT_GPERFTOOLS )
  find_package(Gperftools)
endif (OPT_GPERFTOOLS)

find_package(YmTools REQUIRED)


# ===================================================================
# インクルードパスの設定
# ===================================================================
include_directories (
  ${PROJECT_SOURCE_DIR}/include
  ${PROJECT_BINARY_DIR}
  ${YmTools_INCLUDE_DIRS}
  include
  )

if (TCL_FOUND)
  include_directories ( ${TCL_INCLUDE_PATH} )
endif (TCL_FOUND)


# ===================================================================
#  ソースファイルの設定
# ===================================================================

set (base_SOURCES
  src/base/FaultMgr.cc
  src/base/NodeSet.cc
  src/base/NodeValList.cc
  src/base/TestVector.cc
  src/base/TpgFault.cc
  src/base/TpgMap.cc
  src/base/TpgNetwork.cc
  src/base/TpgNode.cc
  src/base/TvMgr.cc
  )

set (sat_engine_SOURCES
  src/sat_engine/SatEngine.cc
  src/sat_engine/VidLitMap.cc
  src/sat_engine/GvalCnf.cc
  src/sat_engine/FvalCnf.cc
  src/sat_engine/MvalCnf.cc
  src/sat_engine/Extractor.cc
  src/sat_engine/LitMap.cc
  src/sat_engine/ModelValMap.cc
  src/sat_engine/GenVidMap.cc
  )

set (dtpg_SOURCES
  src/dtpg/bt/BackTracer.cc
  src/dtpg/bt/BtImpl.cc
  src/dtpg/bt/BtJust1.cc
  src/dtpg/bt/BtJust2.cc
  src/dtpg/bt/BtJustBase.cc
  src/dtpg/bt/BtSimple.cc

  src/dtpg/dop/DopBase.cc
  src/dtpg/dop/DopDrop.cc
  src/dtpg/dop/DopDummy.cc
  src/dtpg/dop/DopList.cc
  src/dtpg/dop/DopTvList.cc
  src/dtpg/dop/DopVerify.cc
  src/dtpg/dop/FopDrop.cc

  src/dtpg/main/DtpgSat.cc
  src/dtpg/main/DtpgSatBaseM.cc
  src/dtpg/main/DtpgSatS.cc
  src/dtpg/main/DtpgSatM.cc

  src/dtpg/uop/UopBase.cc
  src/dtpg/uop/UopDummy.cc
  src/dtpg/uop/UopList.cc
  src/dtpg/uop/UopSkip.cc
  )

set (fsim_SOURCES
  src/fsim/fop/FopKDet.cc

  src/fsim/fsim2/EventQ.cc
  src/fsim/fsim2/Fsim2.cc
  src/fsim/fsim2/SimNode.cc
  src/fsim/fsim2/SnAnd.cc
  src/fsim/fsim2/SnGate.cc
  src/fsim/fsim2/SnInput.cc
  src/fsim/fsim2/SnOr.cc
  src/fsim/fsim2/SnXor.cc

  src/fsim/fsim3/EventQ.cc
  src/fsim/fsim3/Fsim3.cc
  src/fsim/fsim3/SimNode.cc
  src/fsim/fsim3/SnAnd.cc
  src/fsim/fsim3/SnGate.cc
  src/fsim/fsim3/SnInput.cc
  src/fsim/fsim3/SnOr.cc
  src/fsim/fsim3/SnXor.cc
  )

set (graphsat_SOURCES
  src/graphsat/AssignList.cc
  src/graphsat/GraphSat.cc
  src/graphsat/GraphSatR.cc
  src/graphsat/SaBase.cc
  src/graphsat/SaFactory.cc
  src/graphsat/SaUIP1.cc
  src/graphsat/SaUIP2.cc
  src/graphsat/SatClause.cc
  src/graphsat/VarHeap.cc
  )

set (minpat_SOURCES
  src/minpat/DetOp.cc
  src/minpat/Verifier.cc
  src/minpat/MinPatBase.cc
  src/minpat/MinPatNaive.cc
  src/minpat/MinPatSimple.cc
  src/minpat/MinPatSimple2.cc
  src/minpat/MinPatDsatur.cc
  src/minpat/MinPatDsatur2.cc
  src/minpat/FaultAnalyzer.cc
  src/minpat/EqChecker.cc
  src/minpat/DomChecker.cc
  src/minpat/ConflictChecker.cc
  src/minpat/FgMgrBase.cc
  src/minpat/Compactor.cc
  src/minpat/EqSet.cc
  src/minpat/McOp.cc
  src/minpat/McCompactor.cc
  )

set (rtpg_SOURCES
  src/rtpg/FopRtpg.cc
  src/rtpg/RtpgImpl.cc
  )

set (atpg_tclsh_SOURCES
  src/atpg_tclsh/tclAppInit.cc
  src/atpg_tclsh/atpg_init.cc
  src/atpg_tclsh/AtpgCmd.cc
  src/atpg_tclsh/AtpgMgr.cc
  src/atpg_tclsh/AtpgMsgHandler.cc
  src/atpg_tclsh/NtwkIoCmd.cc
  src/atpg_tclsh/PrintFaultCmd.cc
  src/atpg_tclsh/PrintPatCmd.cc
  src/atpg_tclsh/PrintPatStatsCmd.cc
  src/atpg_tclsh/PrintStatsCmd.cc
  src/atpg_tclsh/TimeCmd.cc
  src/atpg_tclsh/RtpgCmd.cc
  src/atpg_tclsh/DtpgCmd.cc
  src/atpg_tclsh/MinPatCmd.cc
  )


# ===================================================================
#  ターゲットの設定
# ===================================================================
add_library(satpg_base OBJECT ${base_SOURCES})

add_library(satpg_sat_engine OBJECT ${sat_engine_SOURCES})

add_library(satpg_dtpg OBJECT ${dtpg_SOURCES})

add_library(satpg_fsim OBJECT ${fsim_SOURCES})

#add_library(satpg_graphsat OBJECT ${graphsat_SOURCES})

add_library(satpg_minpat OBJECT ${minpat_SOURCES})

add_library(satpg_rtpg OBJECT ${rtpg_SOURCES})

if (TCL_FOUND)
  add_executable(atpg_tclsh
    ${atpg_tclsh_SOURCES}
    $<TARGET_OBJECTS:satpg_sat_engine>
    $<TARGET_OBJECTS:satpg_dtpg>
#    $<TARGET_OBJECTS:satpg_graphsat>
    $<TARGET_OBJECTS:satpg_fsim>
    $<TARGET_OBJECTS:satpg_minpat>
    $<TARGET_OBJECTS:satpg_rtpg>
    $<TARGET_OBJECTS:satpg_base>
    )

  target_link_libraries(atpg_tclsh
    ym_networks
    ym_tclpp
    ym_algo
    ${TCL_LIBRARIES}
    )
endif (TCL_FOUND)


# ===================================================================
#  テストの設定
# ===================================================================

add_executable ( satpg_simnode_test
  src/fsim/fsim3/simnode_test.cc
  $<TARGET_OBJECTS:satpg_fsim>
  $<TARGET_OBJECTS:satpg_base>
  )

target_link_libraries( satpg_simnode_test
    ym_networks
    )

add_test (
  NAME satpg_simnode_test_run
  COMMAND satpg_simnode_test
  )